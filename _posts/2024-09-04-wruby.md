---
title: The wruby static site generator
date: 2024-09-04
layout: post
published: true
---

I came across a static site generator called [wruby](https://wruby.btxx.org).

It's a single-file static site generator and blogging platform. All in one file!

It's a really cool idea for a project. 
As of September 2024, the site at  this domain is built with 
[Jekyll](https://jekyllrb.com).

If using an external theme, Jekyll is easy to manage. But
developing a custom theme and writing among the same directories is overwhelming
when the urgent thing is creating a new post. There is a dedicated
directory called `_posts/`, but it's one among many like `_data/`,
`_includes/`, or `_layouts/`, directory names prefixed by an underscore 
to indicate their exclusion from the output folder (called `_site/`) 
generated by Jekyll. 

This is one of many conventions that Jekyll adopts to make working with its internal
tooling easier. The breadth of configuration Jekyll provides is one of its strongest features 
for developers. It allows for complex website design &mdash;not
to be confused with complicated &mdash; and leaves the frontend 
architecture entirely up to the programmer. 

For example, this website runs on Jekyll. This post is currently a markdown
file in the `_posts` folder, a file I have open in Sublime Text. When I'm
ready to see a preview of my changes, I should run the command `bundle exec jekyll serve` 
to start a local server that shows a live version of the output created by the
Jekyll build process.

This command is of course far too long to type every time I want to restart my server,
so I aliased it in my shell to `pvw`, short for `preview`. Although changes 
in the source files cause Jekyll to rebuild and update the page 
automatically, I used the function throughout development enough times to warrant
a shortcut, since configuration file changes do require a restart.

The command itself is long because the program needs to ensure 
gem dependencies are met. Jekyll provides a large number of features
through gems, such as search engine optimization, pagination, support
for a template language, and even complete themes. 

<div style="text-align: center; padding: 1rem;" >
&mdash;&mdash;&mdash;
</div>

I read Giles Turnbull's thoughts on [gilest.org](https://gilest.org/indie-easy.html) about what
independent publishing web publishing in the style of the [Indieweb](https://indieweb.org) needs:

> We need more self-hosted platforms for personal publishing that aren’t Wordpress. And don’t point me to Hugo or Netlify or Eleventy or all those things - all of them are great, but none of them are simple enough. We need web publishing tools that do not require users to open the Terminal at all. And we need lots of them.

And it's true. I remember spending a few days over a couple of months this past year
reading the Jekyll documentation and getting familiar with its suite of 
dependencies and conventions, from the syntax of the Liquid template language to
the configuration options and default variable values. And that was the first part. 
Next is understanding how Jekyll integrates with Github Pages 
using Github Actions, and while Github does provide Jekyll support by default,
there are conflicts between the `github-pages` gem and some Jekyll versions. 
One such example is Jekyll and its default template, which required me to
update a Gemfile, remove the Jekyll gem, then to include github-pages and webrick.
Add Linux as a platform to the Gemfile.lock before commiting and pushing changes
to the repository. 

At one point the project file structure starts looking something like this:

~~~sh
.
├── _config.yml
├── _data
│   └── members.yml
├── _drafts
│   ├── begin-with-the-crazy-ideas.md
│   └── on-simplicity-in-technology.md
├── _includes
│   ├── footer.html
│   └── header.html
├── _layouts
│   ├── default.html
│   └── post.html
├── _posts
│   ├── 2007-10-29-why-every-programmer-should-play-nethack.md
│   └── 2009-04-26-barcamp-boston-4-roundup.md
├── _sass
│   ├── _base.scss
│   └── _layout.scss
├── _site
├── .jekyll-cache
│   └── Jekyll
│       └── Cache
│           └── [...]
├── .jekyll-metadata
└── index.html # can also be an 'index.md' with valid front matter
~~~


As a programmer who has grown extremely fond of the Ruby programming language
and its community, learning all this was a fun hobby. I watched tutorials on YouTube, I read
a bit about the history behind each project. It was really cool to find out
that Jekyll was built by [Tom Preston-Werner](https://tom.preston-werner.com), who also created GitHub. I learned Liquid was developed by Shopify.

I read the documentation of individual dependencies and Jekyll's tooling ecosystem
including YAML, Liquid, SASS (and the difference between it and SCSS, since if you *do* 
opt for a third-party theme, sometimes these files were included because Jekyll has support for SASS
by default). The barrier to entry for blogging on Jekyll is spread across
software projects maintained by volunteers, some of whom have abandonded
them in favor of newer static site generator technologies like 
[Hugo](https://gohugo.io/),
[Eleventy](https://www.11ty.dev),
or [Zola](https://www.getzola.org).

This means that dependencies break, and sometimes it's
not immediately clear why.

In his article, Giles goes on to say:

> Let’s give people choices. Let’s give people options for tools they can set up and use, with no more knowledge than the knowledge they already have.

<div style="text-align: center; padding: 1rem;" >
&mdash;&mdash;&mdash;
</div>

Bradley Taunt, the author of the single-file [wruby](https://wruby.btxx.org) static site generator, offers
an alternative to Jekyll's complexity by writing a program that synthesizes template language
and build system. The CSS of the site is reduced to few changes on the default 
browser settings packed into a minimized stylesheet, all within the same `header.html` file
that handles navigation.

This is the right idea. 

I initially tested Bradley's static site generator on Termux, a terminal emulator for 
Android running on a tablet. I knew I had to try it when his sourcehut repository 
proudly claimed Ruby as its only dependency.

![wruby README screenshot](/assets/images/wruby-readme.jpeg)

All I had to do was run `make build` and the dependencies it needed 
([kramdown](https://kramdown.gettalong.org/index.html) for markdown 
to html conversion and [rss](https://rubygems.org/gems/rss) for producing 
the rss feed). 

Ironically, there was an issue with the build, as the specified version
on the [inline Gemfile](https://bundler.io/guides/bundler_in_a_single_file_ruby_script.html)
block was 0.3.0 but my system had a more recent version (0.3.1).

```ruby
require 'bundler/inline'
gemfile do
  gem 'kramdown', '2.4.0'
  gem 'rss', '0.3.0'
end
```

After fixing this with a quick edit in a text editor, I was able to get
the project built immediately.

```python
python3 -m http.server --directory build
```

I used the only one-liner command I can reliably recall for starting 
up a server and the built site was server with no issues. Awesome.

<div style="text-align: center; padding: 1rem;" >
&mdash;&mdash;&mdash;
</div>

Following Bradley's footsteps, today I began work on a one-file static 
site generator tentatively called Arrow. The goal is to eventually handle
the maintenance of this website through it.

The work so far has been exploratory. I cloned the 
[wruby repository](https://git.sr.ht/~bt/wruby) and spent
most of today deploying a site created with wruby to Github Pages. I
captured this process and programmed it as a Rake task, moving away from
[Make](https://www.gnu.org/software/make/) to maintain wruby's goal of
being platform agnostic.

Next, I'll be creating a Content Management System with Rake,
since it will be the cleanest way to manage repeatable tasks such
as creating a new post, building the site, and deploying to Github 
Pages. 

I'll leave the `config.yml` file alone, but I'll remove the need to
prefix an underscore since that's a Jekyll convention.

I expect to rewrite the entire application from scratch in the coming
days, but I wanted to mention Bradley's project 
first both for its influence on mine as well as to "give people options for tools they can set up and use". Its biggest contribution to the design of my 
static site generator will be its reiteration of the 
[Unix philosophy](https://en.wikipedia.org/wiki/Unix_philosophy#Origin).

wruby does one thing and it does it well. It takes a series of files
and outputs a folder ready to be deployed. I'll be adhering to this
by relying on Github Pages for hosting, thus automation of processes
in my project will heavily rely on git. 

A future abstraction layer over this step may be needed in future releases
of an entirely different project.












